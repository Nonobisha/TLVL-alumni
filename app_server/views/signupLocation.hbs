<div style="background-color:#F8F9FA;">

 {{>navbar reg='active'}}

 <div class="container">
    <form class="form-horizontal" role="form" method="POST" action="/signupLocation">
       
           <div class="row">
            <div class="col-md-3 field-label-responsive">
                <label for="addr">Город в котором находитесь</label>
            </div>
            <div class="col-md-6">
      
        
        <div id="search" class = "form-group" style="margin-left:  2.6rem" required>
            <div class="row">
            <div class = "col-md-6">
            <input type="text" required name="addr" value="" id="addr" class ="addr form-control" size="10" oninvalid="this.setCustomValidity('Город обязателен')"
 oninput="setCustomValidity('')" />
        </div>
        <div class = "col-md-6">
            <button type="button" class="btn btn-info" onclick="addr_search();">Поиск</button>
            </div>
        </div>
            <div id="results"/>
        </div>
            </div>
            <div class="col-md-3">
                <div class="form-control-feedback">
                        <span class="text-danger align-middle">
                            <!-- Put name validation error messages here -->
                        </span>
                </div>
            </div>
        </div>
    </div>

    <br/>

        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-6 text-center">
                <button type="submit" class="btn btn-success"><i class="fa fa-user-plu "></i> Зарегистрироваться</button>
            </div>
        </div>

  <input type="hidden" name="lat" value="" id="lat" class ="lat" size="10">
  <input type="hidden" name="lon" value="" id="lon" class ="lon" size="10">
  <input type="hidden" name="display_name" id="display_name" class ="display_name" size="10">


    </form>
   

</div>


    <script>
       
function chooseAddr(lat1, lng1, lat2, lng2, display_name) {
    console.log(lat1 + "/" + lng1 + "/" + display_name);
    $('#results').empty();
    $("#realAddr").val(lat1 + "/" +  lng1);
    $('<b>', { html: "Вы выбрали адрес: " + display_name }).appendTo('#results');
	$("#lat").val(lat1);
	$("#lon").val(lng1);
    $("#display_name").val(display_name);
  
}

function addr_search() {
    let inp = document.getElementById("addr");
    
    $.getJSON('http://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + inp.value, function(data) {
        let items = [];
        let temp = 0;
          if(data.length != 0) {
        $.each(data, function(key, val) {
            bb = val.boundingbox;
                 if(val.type == "administrative" || val.type == "city" || val.type == "town"){
            items.push("<li><a href='#' onclick='chooseAddr(" + bb[0] + ", " + bb[2] + ", " + bb[1] + ", " + bb[3]  + ", \"" + val.display_name + "\");return false;'>" + val.display_name + '</a></li>');
            temp++;
        }
        });
    }
        if(temp == 0) {
           items.push("<p><b>Город не найден.</b></p>");
         }
    else if(data.length == 0){
         console.log("No location found");
    items.push("<p><b>Город не найден.</b></p>");
}
  $('#results').empty();
            $('<ul/>', {
                'class': 'my-new-list',
                html: items.join('')
            }).appendTo('#results');
    });
}
</script>


{{>footer}}

</div>